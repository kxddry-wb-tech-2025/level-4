# Профилирование REST API сервиса

## Запуск

(добавьте все необходимые переменные окружения, докеркомпоз подскажет)

    ```bash
    cd src
    docker-compose up -d
    ``` 

## Профилирование

    ```bash
    go tool pprof -http=:8081 "http://localhost:6060/debug/pprof/profile?seconds=20"
    ```

## Нагрузка:

- создание заказа - примерно 600 RPS обрабатывается сервером.

    ```bash
    cd stresser
    go run cmd/stresser
    ```

на текущий момент слабое место - создание транзакции в БД.


## Метрики

- в сервисе подключены метрики Prometheus, посмотреть можно в графане на `http://localhost:3000`


## Комментарии

> На данный момент, проводя нагрузку своим ддосером, замечаю, что огромная часть процессора уходит под `crypto/internal/fips140/sha256.blockAVX2`.

- Я перешёл на пулы, 600 RPS превратились в 3000 RPS.

На данный момент ботлнеком являются echo Handler func, Service func, json Decoder, и всякие штуки из рантайма
типа futex.
Ещё заметно - 11% уходит под сисколлы. Попробую снизить логирование.

### TODO

- [X] перешёл на пулы
- [ ] Поменять encoding/json на fastjson.
- [ ] Убрать лишнее логирование.